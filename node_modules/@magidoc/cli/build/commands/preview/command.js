import { withStacktrace } from '../utils/withStacktrace.js';
import path from 'path';
import preview from './index.js';
import { loadFileConfiguration } from '../utils/loadConfigFile.js';
import { templates } from '@magidoc/plugin-starter-variables';
import { CONFIG_FILE_OPTION, newPortOption, STACKTRACE_OPTION } from '../utils/commander.js';

function buildPreviewCommand(program) {
    program
        .command('preview')
        .description('Preview the documentation website generated with the generate `generate` command.')
        .addOption(CONFIG_FILE_OPTION())
        .addOption(newPortOption('The port to bind the preview server to.', 4000))
        .addOption(STACKTRACE_OPTION())
        .action(async ({ file, port, stacktrace }) => {
        const fileConfiguration = await loadFileConfiguration(file, stacktrace);
        if (!fileConfiguration) {
            process.exitCode = 1;
            return;
        }
        await withStacktrace(stacktrace, () => {
            const root = fileConfiguration.website.options[templates.SITE_ROOT.name];
            preview({
                websiteLocation: path.resolve(fileConfiguration.website.output),
                port,
                siteRoot: root ? String(root) : undefined,
            });
        });
    });
}

export { buildPreviewCommand as default };
//# sourceMappingURL=command.js.map
