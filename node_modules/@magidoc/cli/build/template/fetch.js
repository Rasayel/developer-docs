import fs from 'fs-extra';
import axios from 'axios';

const templateUrl = 'https://github.com/magidoc-org/magidoc/releases/download/<version>/starter-<name>.zip';
async function fetchTemplate(config) {
    const targetUrl = templateUrl
        .replace('<version>', config.version)
        .replace('<name>', config.template);
    await axios
        .request({
        method: 'get',
        url: targetUrl,
        responseType: 'stream',
    })
        .then(async (response) => {
        const writer = fs.createWriteStream(config.destination);
        return new Promise((resolve, reject) => {
            writer.on('error', (error) => {
                error = error;
                writer.close();
                reject(error);
            });
            writer.on('close', () => {
                {
                    resolve(true);
                }
            });
            response.data.pipe(writer);
        });
    })
        .catch((error) => {
        if (error.response) {
            if (error.response.status === 404) {
                throw new Error(`Could not find template '${config.template}' with version '${config.version}'. \nSearched the following location: \n - ${targetUrl}`, error);
            }
        }
        throw new Error(`Unable to fetch template at ${targetUrl}`, error);
    });
}

export { fetchTemplate as default };
//# sourceMappingURL=fetch.js.map
